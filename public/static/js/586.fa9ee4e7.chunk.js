"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[586],{9586:function(e,n,t){t.r(n),t.d(n,{default:function(){return S}});var i=t(5861),r=t(885),a=t(7757),s=t.n(a),d=t(2791),l=t(6030);var o=t.p+"static/media/profile.b84b8a2c1d6f60abcdd2862de84f4e00.svg";var u=t.p+"static/media/edit.a011e086aec8dbc9872be301484fb22d.svg",c=t(8155),f=t(3456);function v(){return v=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},v.apply(this,arguments)}var p=function(e){var n=(0,d.useRef)(e);return n.current=e,n},h=function(e){var n=void 0===e?{}:e,t=n.requestOptions,i=n.debounce,r=void 0===i?200:i,a=n.cache,s=void 0===a?86400:a,l=n.cacheKey,o=n.googleMaps,u=n.callbackName,c=n.defaultValue,f=void 0===c?"":c,h=n.initOnMount,g=void 0===h||h,m=(0,d.useState)(!1),x=m[0],j=m[1],b=(0,d.useState)(f),y=b[0],_=b[1],w=(0,d.useState)({loading:!1,status:"",data:[]}),k=w[0],S=w[1],E=(0,d.useRef)(null),N=p(t),C=p(o),A=l?"upa-"+l:"upa",O=(0,d.useCallback)((function(){var e;if(!E.current){var n=window.google,t=C.current,i=(null==t?void 0:t.places)||(null==n||null==(e=n.maps)?void 0:e.places);i?(E.current=new i.AutocompleteService,j(!0)):console.error("\ud83d\udca1 use-places-autocomplete: Google Maps Places API library must be loaded. See: https://github.com/wellyshen/use-places-autocomplete#load-the-library")}}),[]),L=(0,d.useCallback)((function(){S({loading:!1,status:"",data:[]})}),[]),I=(0,d.useCallback)((function(){try{sessionStorage.removeItem(A)}catch(e){}}),[]),P=(0,d.useCallback)(function(e,n){var t;return function(){for(var i=this,r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];null!==t&&(clearTimeout(t),t=null),t=setTimeout((function(){return e.apply(i,a)}),n)}}((function(e){if(e){S((function(e){return v({},e,{loading:!0})}));var n={};try{n=JSON.parse(sessionStorage.getItem(A)||"{}")}catch(t){}s&&(n=Object.keys(n).reduce((function(e,t){return n[t].maxAge-Date.now()>=0&&(e[t]=n[t]),e}),{}))[e]?S({loading:!1,status:"OK",data:n[e].data}):E.current.getPlacePredictions(v({},N.current,{input:e}),(function(i,r){if(S({loading:!1,status:r,data:i||[]}),s&&"OK"===r){n[e]={data:i,maxAge:Date.now()+1e3*s};try{sessionStorage.setItem(A,JSON.stringify(n))}catch(t){}}}))}else L()}),r),[r,L]),Z=(0,d.useCallback)((function(e,n){void 0===n&&(n=!0),_(e),E.current&&n&&P(e)}),[P]);return(0,d.useEffect)((function(){if(!g)return function(){return null};var e=window.google;return C.current||null!=e&&e.maps||!u?O():window[u]=O,function(){window[u]&&delete window[u]}}),[u,O]),{ready:x,value:y,suggestions:k,setValue:Z,clearSuggestions:L,clearCache:I,init:O}},g=function(e,n){var t;return null==(t=e.classList)?void 0:t.contains(n)},m=function(e,n){for(var t=e.target||e;t;){if(Array.isArray(n)){if(n.some((function(e){return g(t,e)})))return!0}else if(g(t,n))return!0;t=t.parentElement}return!1},x=function(e){return!(!e.includes("touch")||!function(){if("undefined"===typeof window||"function"!==typeof window.addEventListener)return!1;var e=!1,n=Object.defineProperty({},"passive",{get:function(){e=!0}}),t=function(){return null};return window.addEventListener("test",t,n),window.removeEventListener("test",t,n),e}())&&{passive:!0}},j=function(e,n){var t=void 0===n?{}:n,i=t.refs,r=t.disabled,a=t.eventTypes,s=void 0===a?["mousedown","touchstart"]:a,l=t.excludeScrollbar,o=t.ignoreClass,u=void 0===o?"ignore-onclickoutside":o,c=t.detectIFrame,f=void 0===c||c,v=(0,d.useState)([]),p=v[0],h=v[1],g=(0,d.useRef)(e);g.current=e;var j=(0,d.useCallback)((function(e){return h((function(n){return[].concat(n,[{current:e}])}))}),[]);return(0,d.useEffect)((function(){if(null!=i&&i.length||p.length){var e=function(){var e=[];return(i||p).forEach((function(n){var t=n.current;return t&&e.push(t)})),e},n=function(n){m(n,u)||l&&function(e){return document.documentElement.clientWidth<=e.clientX||document.documentElement.clientHeight<=e.clientY}(n)||!e().every((function(e){return!e.contains(n.target)}))||g.current(n)},t=function(n){return setTimeout((function(){var t=document.activeElement;"IFRAME"!==(null==t?void 0:t.tagName)||m(t,u)||e().includes(t)||g.current(n)}),0)},a=function(){s.forEach((function(e){return document.removeEventListener(e,n,x(e))})),f&&window.removeEventListener("blur",t)};if(!r)return s.forEach((function(e){return document.addEventListener(e,n,x(e))})),f&&window.addEventListener("blur",t),function(){return a()};a()}}),[p,u,l,r,f,JSON.stringify(s)]),j},b=t(184);function y(e){var n=e.isLoaded,t=e.setAddress,i=e.address,r=h({initOnMount:!1,debounce:300}),a=r.ready,s=r.value,l=r.suggestions,o=l.status,u=l.data,c=r.setValue,f=r.init,v=r.clearSuggestions;(0,d.useEffect)((function(){n&&f()}),[n,f]),(0,d.useEffect)((function(){i&&i!==s&&c(i)}),[i]);var p=j((function(){v()})),g=function(e){var n=e.description;return function(){t(n),c(n,!1),v()}};return(0,b.jsxs)("div",{ref:p,className:"google-autocomplete",children:[(0,b.jsx)("input",{value:s,onChange:function(e){c(e.target.value)},disabled:!a}),"OK"===o&&(0,b.jsx)("ul",{children:u.map((function(e){var n=e.place_id,t=e.structured_formatting,i=t.main_text,r=t.secondary_text;return(0,b.jsxs)("li",{onClick:g(e),children:[(0,b.jsx)("strong",{children:i})," ",(0,b.jsx)("small",{children:r})]},n)}))})]})}var _=["places"];function w(e){var n,t,i,a,s=e.user,l=e.updateProfile,o=e.updateUserAvatar,u=e.setIsEdit,c=(0,d.useState)(s.surname),v=(0,r.Z)(c,2),p=v[0],h=v[1],g=(0,d.useState)(s.name),m=(0,r.Z)(g,2),x=m[0],j=m[1],w=(0,d.useState)(s.phone),k=(0,r.Z)(w,2),S=k[0],E=k[1],N=(0,d.useState)(s.email),C=(0,r.Z)(N,2),A=C[0],O=C[1],L=(0,d.useState)((null===s||void 0===s||null===(n=s.data)||void 0===n?void 0:n.birthday)&&s.data.birthday),I=(0,r.Z)(L,2),P=I[0],Z=I[1],K=(0,d.useState)((null===s||void 0===s||null===(t=s.data)||void 0===t?void 0:t.gender)&&s.data.gender),R=(0,r.Z)(K,2),F=R[0],M=R[1],T=(0,d.useState)((null===s||void 0===s||null===(i=s.data)||void 0===i?void 0:i.city)&&s.data.city),U=(0,r.Z)(T,2),D=U[0],J=(U[1],(0,d.useState)((null===s||void 0===s||null===(a=s.data)||void 0===a?void 0:a.address)&&s.data.address)),V=(0,r.Z)(J,2),z=V[0],H=V[1],Q=(0,d.useRef)(),W=(0,f.Ji)({id:"google-map-script",googleMapsApiKey:"AIzaSyAIKajZccQTPUwasl0PNHFpWaKSKlrzPxQ",libraries:_}).isLoaded;(0,d.useEffect)((function(){M(Q.current.value)}),[]);return(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"editprofile-block__grid grid-editprofile",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{children:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f"}),(0,b.jsx)("input",{id:"user__surname",value:p,onChange:function(e){return h(e.target.value)},type:"text"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{children:"\u0418\u043c\u044f"}),(0,b.jsx)("input",{id:"user__name",value:x,onChange:function(e){return j(e.target.value)},type:"text"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{children:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"}),(0,b.jsx)("input",{value:S,placeholder:(null===s||void 0===s?void 0:s.phone)&&s.phone,onChange:function(e){return E(e.target.value)},type:"text"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{children:"E-mail"}),(0,b.jsx)("input",{value:A,onChange:function(e){return O(e.target.value)},type:"text",disabled:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{children:"\u0414\u0430\u0442\u0430 \u0440\u043e\u0436\u0434\u0435\u043d\u0438\u044f"}),(0,b.jsx)("input",{value:P,onChange:function(e){return Z(e.target.value)},type:"date"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{children:"\u041f\u043e\u043b"}),(0,b.jsxs)("select",{ref:Q,id:"gender",name:"gender",value:F,onChange:function(e){return M(e.target.value)},children:[(0,b.jsx)("option",{value:"\u041c\u0443\u0436\u0441\u043a\u043e\u0439",children:"\u041c\u0443\u0436\u0441\u043a\u043e\u0439"}),(0,b.jsx)("option",{value:"\u0416\u0435\u043d\u0441\u043a\u0438\u0439",children:"\u0416\u0435\u043d\u0441\u043a\u0438\u0439"})]})]}),(0,b.jsxs)("div",{className:"grid-editprofile__address",children:[(0,b.jsx)("span",{children:"\u0410\u0434\u0440\u0435\u0441"}),(0,b.jsx)(y,{isLoaded:W,setAddress:H,address:z})]})]}),(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,b.jsx)("button",{className:"editprofile-block__save-edit",onClick:function(){return l(A,p,x,S,{birthday:P,gender:F,city:D,address:z}),void o()},children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"}),(0,b.jsx)("button",{className:"editprofile-block__save-edit",onClick:function(){return u(!1)},children:"\u041e\u0442\u043c\u0435\u043d\u0430"})]})]})}function k(){var e,n,t,i,r=(0,l.v9)((function(e){return e.user})),a=r.currentUser,s=r.isLoading;return(0,b.jsx)("div",{children:s?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"editprofile-block__username",children:(0,b.jsxs)("div",{children:[a.surname," ",a.name]})}),(0,b.jsxs)("div",{className:"editprofile-block__grid grid-editprofile",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{children:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"}),(0,b.jsx)("div",{className:"grid-editprofile__loadinfo",children:a.phone})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{children:"E-mail"}),(0,b.jsx)("div",{className:"grid-editprofile__loadinfo",children:a.email})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{children:"\u0414\u0430\u0442\u0430 \u0440\u043e\u0436\u0434\u0435\u043d\u0438\u044f"}),(0,b.jsx)("div",{className:"grid-editprofile__loadinfo",children:(null===a||void 0===a||null===(e=a.data)||void 0===e?void 0:e.birthday)&&a.data.birthday})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{children:"\u041f\u043e\u043b"}),(0,b.jsx)("div",{className:"grid-editprofile__loadinfo",children:(null===a||void 0===a||null===(n=a.data)||void 0===n?void 0:n.gender)&&a.data.gender})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{children:"\u0433\u043e\u0440\u043e\u0434"}),(0,b.jsx)("div",{className:"grid-editprofile__loadinfo",children:(null===a||void 0===a||null===(t=a.data)||void 0===t?void 0:t.city)&&a.data.city})]}),(0,b.jsxs)("div",{className:"grid-editprofile__address",children:[(0,b.jsx)("span",{children:"\u0410\u0434\u0440\u0435\u0441"}),(0,b.jsx)("div",{className:"grid-editprofile__loadinfo",children:(null===a||void 0===a||null===(i=a.data)||void 0===i?void 0:i.address)&&a.data.address})]})]})]}):(0,b.jsx)("h1",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"})})}function S(){var e=(0,d.useState)(!1),n=(0,r.Z)(e,2),t=n[0],a=n[1],f=(0,d.useState)(null),v=(0,r.Z)(f,2),p=v[0],h=v[1],g=(0,l.v9)((function(e){return e.user.currentUser})),m=(0,d.useRef)(),x=(0,l.I0)();(0,d.useEffect)((function(){document.body.scrollIntoView({behavior:"smooth"})}),[]);var j=function(){var e=(0,i.Z)(s().mark((function e(n,t,i,r,d){var l,o,u,f;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=d.birthday,o=d.gender,u=d.city,f=d.address,a(!1),e.next=4,x((0,c.uz)(n,t,i,r,{birthday:l,gender:o,city:u,address:f}));case 4:case"end":return e.stop()}}),e)})));return function(n,t,i,r,a){return e.apply(this,arguments)}}();return(0,b.jsxs)("section",{className:"edit-profile",children:[(0,b.jsxs)("div",{className:"edit-profile__block-avatar avatar-block",children:[(0,b.jsx)("label",{id:"avatar-label",htmlFor:"avatar",children:(0,b.jsx)("img",{ref:m,src:g.avatar?g.avatar:o,alt:"avatar"})}),(0,b.jsx)("input",{onChange:function(e){if(console.log(e.target.files[0]),e.target.files[0]){var n=new FileReader;n.addEventListener("load",(function(){m.current.src=n.result}),!1),n.readAsDataURL(e.target.files[0]);var t=new FormData;t.append("fileData",e.target.files[0]),console.log(t),fetch("/api/files",{method:"POST",body:t}).then((function(e){return e.text()})).then((function(e){h("/upload/"+e)})).catch((function(e){return console.log(e)}))}},type:"file",id:"avatar",disabled:!t})]}),(0,b.jsx)("img",{className:"editprofile-block__image",src:u,alt:"edit",onClick:function(){return a(!0)}}),(0,b.jsx)("div",{className:"edit-profile__block-profile editprofile-block",children:t?(0,b.jsx)(w,{setIsEdit:a,user:g,updateProfile:j,updateUserAvatar:function(){console.log("start fetch"),p&&x((0,c.ip)(g.email,p))}}):(0,b.jsx)(k,{})})]})}}}]);
//# sourceMappingURL=586.fa9ee4e7.chunk.js.map